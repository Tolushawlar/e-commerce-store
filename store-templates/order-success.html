<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Confirmed - {{store_name}}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: {{primary_color}};
            --accent: {{accent_color}};
        }
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        
        @keyframes checkmark {
            0% {
                stroke-dashoffset: 100;
            }
            100% {
                stroke-dashoffset: 0;
            }
        }

        @keyframes circle {
            0% {
                stroke-dashoffset: 240;
            }
            100% {
                stroke-dashoffset: 480;
            }
        }

        .checkmark-circle {
            stroke-dasharray: 240;
            stroke-dashoffset: 480;
            animation: circle 0.6s ease-in-out forwards;
        }

        .checkmark-check {
            stroke-dasharray: 100;
            stroke-dashoffset: 100;
            animation: checkmark 0.3s 0.6s ease-in-out forwards;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white border-b border-gray-200 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <a href="index.html" class="flex items-center gap-3">
                    <span id="store-name" class="text-xl font-bold" style="color: var(--primary);">{{store_name}}</span>
                </a>
            </div>
        </div>
    </header>

    <main class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <!-- Success Animation -->
        <div class="text-center mb-8">
            <div class="inline-block">
                <svg width="120" height="120" viewBox="0 0 120 120">
                    <circle class="checkmark-circle" cx="60" cy="60" r="54" fill="none" stroke="var(--primary)" stroke-width="4"/>
                    <path class="checkmark-check" d="M35 60 L50 75 L85 40" fill="none" stroke="var(--primary)" stroke-width="6" stroke-linecap="round"/>
                </svg>
            </div>
            <h1 class="text-3xl font-bold text-gray-900 mt-6 mb-2">Order Confirmed!</h1>
            <p class="text-gray-600">Thank you for your purchase</p>
        </div>

        <!-- Order Details -->
        <div id="order-details" class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <div class="flex items-center justify-between mb-6 pb-6 border-b">
                <div>
                    <p class="text-sm text-gray-500">Order Number</p>
                    <p id="order-number" class="text-xl font-bold text-gray-900">Loading...</p>
                </div>
                <div class="text-right">
                    <p class="text-sm text-gray-500">Order Date</p>
                    <p id="order-date" class="text-sm font-semibold text-gray-900">Loading...</p>
                </div>
            </div>

            <div class="mb-6">
                <h2 class="text-lg font-bold text-gray-900 mb-4">Order Items</h2>
                <div id="order-items" class="space-y-3">
                    <!-- Items loaded here -->
                    <div class="flex items-center justify-center py-8">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"></div>
                    </div>
                </div>
            </div>

            <div class="pt-6 border-t">
                <div class="space-y-2 mb-4">
                    <div class="flex justify-between text-gray-600">
                        <span>Subtotal</span>
                        <span id="order-subtotal">₦0.00</span>
                    </div>
                    <div class="flex justify-between text-gray-600">
                        <span>Shipping</span>
                        <span id="order-shipping">₦0.00</span>
                    </div>
                    <div class="flex justify-between text-gray-600">
                        <span>Tax</span>
                        <span id="order-tax">₦0.00</span>
                    </div>
                    <div class="flex justify-between text-lg font-bold text-gray-900 pt-2 border-t">
                        <span>Total</span>
                        <span id="order-total">₦0.00</span>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mt-6 pt-6 border-t">
                <div>
                    <h3 class="text-sm font-semibold text-gray-900 mb-2">Shipping Address</h3>
                    <div id="shipping-address" class="text-sm text-gray-600">
                        <p id="customer-name">Loading...</p>
                        <p id="address-line">Loading...</p>
                        <p id="city-state">Loading...</p>
                    </div>
                </div>
                <div>
                    <h3 class="text-sm font-semibold text-gray-900 mb-2">Contact Information</h3>
                    <div id="contact-info" class="text-sm text-gray-600">
                        <p id="customer-email">Loading...</p>
                        <p id="customer-phone">Loading...</p>
                    </div>
                </div>
            </div>

            <div class="mt-6 pt-6 border-t">
                <h3 class="text-sm font-semibold text-gray-900 mb-2">Payment Method</h3>
                <p id="payment-method" class="text-sm text-gray-600">Loading...</p>
            </div>
        </div>

        <!-- What's Next -->
        <div class="bg-blue-50 rounded-lg p-6 mb-6">
            <h2 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
                <span class="material-symbols-outlined" style="color: var(--primary);">info</span>
                What happens next?
            </h2>
            <ul class="space-y-3 text-sm text-gray-700">
                <li class="flex items-start gap-3">
                    <span class="material-symbols-outlined text-green-600 text-xl">check_circle</span>
                    <span>You'll receive an order confirmation email shortly</span>
                </li>
                <li class="flex items-start gap-3">
                    <span class="material-symbols-outlined text-green-600 text-xl">check_circle</span>
                    <span>We'll notify you when your order is being prepared</span>
                </li>
                <li class="flex items-start gap-3">
                    <span class="material-symbols-outlined text-green-600 text-xl">check_circle</span>
                    <span>Track your order status using the order number above</span>
                </li>
            </ul>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row gap-4">
            <a href="index.html" class="flex-1 text-center px-6 py-3 rounded-lg font-semibold text-white" style="background-color: var(--primary);">
                Continue Shopping
            </a>
            <button onclick="window.print()" class="flex-1 text-center px-6 py-3 border-2 rounded-lg font-semibold text-gray-700 hover:bg-gray-50" style="border-color: var(--primary);">
                Print Receipt
            </button>
        </div>
    </main>

    <script src="checkout.js"></script>
    <script>
        const storeConfig = {
            store_id: {{store_id}},
            apiUrl: window.location.origin + '/api'
        };
        window.storeConfig = storeConfig;
    </script>
    <script>
        // Get order ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const orderId = urlParams.get('order');

        if (!orderId) {
            window.location.href = 'index.html';
        }

        // Load order details
        async function loadOrderDetails() {
            try {
                const result = await CheckoutService.getOrder(orderId);
                
                if (!result.success) {
                    throw new Error('Order not found');
                }

                const order = result.order;

                // Display order information
                document.getElementById('order-number').textContent = order.order_number || `#${order.id}`;
                document.getElementById('order-date').textContent = new Date(order.created_at).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });

                // Display order items
                const itemsContainer = document.getElementById('order-items');
                let calculatedSubtotal = 0;
                
                if (order.items && order.items.length > 0) {
                    itemsContainer.innerHTML = order.items.map(item => {
                        const itemTotal = item.price * item.quantity;
                        calculatedSubtotal += itemTotal;
                        return `
                            <div class="flex justify-between py-2">
                                <div>
                                    <p class="font-semibold text-gray-900">${item.product_name || 'Product'}</p>
                                    <p class="text-sm text-gray-500">Qty: ${item.quantity}</p>
                                </div>
                                <p class="font-semibold" style="color: var(--primary);">${formatCurrency(itemTotal)}</p>
                            </div>
                        `;
                    }).join('');
                } else {
                    itemsContainer.innerHTML = '<p class="text-gray-500">No items found</p>';
                }

                // Display totals
                const shippingCost = parseFloat(order.shipping_cost || 0);
                const totalAmount = parseFloat(order.total_amount || 0);
                const taxAmount = totalAmount - calculatedSubtotal - shippingCost;
                
                document.getElementById('order-subtotal').textContent = formatCurrency(calculatedSubtotal);
                document.getElementById('order-shipping').textContent = formatCurrency(shippingCost);
                document.getElementById('order-tax').textContent = formatCurrency(Math.max(0, taxAmount));
                document.getElementById('order-total').textContent = formatCurrency(totalAmount);

                // Display shipping address
                document.getElementById('customer-name').textContent = order.customer_name;
                document.getElementById('address-line').textContent = order.shipping_address;
                document.getElementById('city-state').textContent = `${order.shipping_city}, ${order.shipping_state} ${order.shipping_postal_code}`;

                // Display contact info
                document.getElementById('customer-email').textContent = order.customer_email;
                document.getElementById('customer-phone').textContent = order.customer_phone;

                // Display payment method
                const paymentMethods = {
                    'card': 'Debit/Credit Card',
                    'transfer': 'Bank Transfer',
                    'cod': 'Cash on Delivery'
                };
                document.getElementById('payment-method').textContent = paymentMethods[order.payment_method] || order.payment_method;

            } catch (error) {
                console.error('Error loading order:', error);
                document.getElementById('order-details').innerHTML = `
                    <div class="text-center py-12">
                        <span class="material-symbols-outlined text-6xl text-red-400 mb-4">error</span>
                        <p class="text-gray-600 text-lg">Failed to load order details</p>
                        <a href="index.html" class="inline-block mt-4 px-6 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800">
                            Back to Store
                        </a>
                    </div>
                `;
            }
        }

        function formatCurrency(amount) {
            return '₦' + Number(amount).toLocaleString('en-NG', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        // Load order on page load
        loadOrderDetails();
    </script>
</body>
</html>
